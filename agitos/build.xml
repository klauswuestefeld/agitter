<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!-- WARNING: Eclipse auto-generated file.
              Any modifications will be overwritten.
              To include a user specific buildfile here, simply create one in the same
              directory with the processing instruction <?eclipse.ant.import?>
              as the first entry and export the buildfile again. -->
<project basedir="." default="build" name="agitos">
	<property environment="env"/>
	<property name="junit.output.dir" value="junit"/>
	<property name="debuglevel" value="source,lines,vars"/>
	<property name="target" value="1.6"/>
	<property name="source" value="1.6"/>

	<!-- Arguments to gwtc and devmode targets -->
	<property name="gwt.args" value="" />

	<path id="gwt-servlet.libraryclasspath">
		<pathelement location="lib/gwt-2.2/gwt-servlet.jar"/>
		<pathelement location="lib/gwt-2.2/gwt-servlet-deps.jar"/>
	</path>
	
	<path id="gwt.libraryclasspath">
		<pathelement location="lib/gwt-2.2/gwt-dev.jar"/>
		<pathelement location="lib/gwt-2.2/gwt-user.jar"/>
		<path refid="gwt-servlet.libraryclasspath"/>
	</path>

	<path id="junit4.libraryclasspath">
		<pathelement location="lib/junit4/junit.jar"/>
		<pathelement location="lib/junit4/org.hamcrest.core_1.1.0.v20090501071000.jar"/>
	</path>

	<path id="agitosdeps.libraryclasspath">
		<pathelement location="lib/social_auth/commons-beanutils.jar"/>
		<pathelement location="lib/social_auth/commons-codec-1.3.jar"/>
		<pathelement location="lib/social_auth/commons-collections-3.1.jar"/>
		<pathelement location="lib/social_auth/commons-digester.jar"/>
		<pathelement location="lib/social_auth/commons-httpclient.jar"/>
		<pathelement location="lib/social_auth/commons-io-1.4.jar"/>
		<pathelement location="lib/social_auth/commons-lang-2.1.jar"/>
		<pathelement location="lib/social_auth/commons-logging-1.1.jar"/>
		<pathelement location="lib/social_auth/commons-validator.jar"/>
		<pathelement location="lib/social_auth/dyuproject-openid-oauth-1.1.7-jarjar.jar"/>
		<pathelement location="lib/social_auth/guice-2.0.jar"/>
		<pathelement location="lib/social_auth/openid4java.jar"/>
		<pathelement location="lib/social_auth/socialauth-1.0-beta2.jar"/>
		<pathelement location="lib/social_auth/twitter4j-core-2.1.3-SNAPSHOT.jar"/>
		<pathelement location="lib/social_auth/visural-common-0.3.2.jar"/>
		<pathelement location="lib/SyncProxy.jar"/>
		<pathelement location="lib/prevayler/prevayler-2.3.jar"/>
		<pathelement location="lib/mail.jar"/>
		<pathelement location="lib/restlet/com.thoughtworks.xstream.jar"/>
	</path>

	<path id="agitos.classpath">
		<pathelement location="war/WEB-INF/classes"/>
		<path refid="gwt.libraryclasspath"/>
		<path refid="junit4.libraryclasspath"/>
		<path refid="agitosdeps.libraryclasspath"/>
	</path>

	<target name="init">
		<mkdir dir="war/WEB-INF/classes"/>
		<copy includeemptydirs="false" todir="war/WEB-INF/classes">
			<fileset dir="src">
				<exclude name="**/*.launch"/>
				<exclude name="**/*.java"/>
			</fileset>
		</copy>
		<copy includeemptydirs="false" todir="war/WEB-INF/classes">
			<fileset dir="test">
				<exclude name="**/*.launch"/>
				<exclude name="**/*.java"/>
			</fileset>
		</copy>
		<copy includeemptydirs="false" todir="war/WEB-INF/classes">
			<fileset dir="spikes">
				<exclude name="**/*.launch"/>
				<exclude name="**/*.java"/>
				<exclude name="samples/jetty_prevayler/"/>
				<exclude name="samples/jetty_prevayler2/"/>
				<exclude name="samples/jetty_prevayler3/"/>
				<exclude name="samples/jetty_prevayler3/simpleprevalent/"/>
				<exclude name="samples/jetty_prevayler3/simpleservlet/"/>
				<exclude name="samples/jetty_servlet/"/>
				<exclude name="samples/restlet/"/>
				<exclude name="foundation/"/>
				<exclude name="foundation/lang/exceptions/"/>
				<exclude name="org/prevayler/bubble/"/>
				<exclude name="org/prevayler/bubble/tests/"/>
				<exclude name="org/prevayler/bubble/tests/fixtures/"/>
				<exclude name="org/prevayler/bubble/tests/fixtures/brick2/"/>
				<exclude name="org/prevayler/bubble/tests/fixtures/brick2/impl/"/>
				<exclude name="org/prevayler/bubble/tests/fixtures/impl/"/>
				<exclude name="org/prevayler/bubble/tests/fixturesnew/"/>
				<exclude name="org/prevayler/bubble/tests/fixturesnew/SomeApplication.java"/>
				<exclude name="org/prevayler/bubble/tests/fixturesnew/SomeApplicationImpl.java"/>
				<exclude name="org/prevayler/"/>
			</fileset>
		</copy>

		<copy includeemptydirs="false" todir="war/WEB-INF/classes">
			<fileset dir="config">
				<exclude name="**/*.launch"/>
				<exclude name="**/*.java"/>
			</fileset>
		</copy>
		
	    <mkdir dir="war/WEB-INF/lib" />
		<copy todir="war/WEB-INF/lib" flatten="yes">
			<path refid="agitosdeps.libraryclasspath"/>
			<path refid="gwt-servlet.libraryclasspath"/>
		</copy>
	</target>

	<target name="clean">
		<delete dir="war/WEB-INF/classes"/>
		<delete dir="war/agitos" failonerror="false" />
		<delete dir="junit" failonerror="false" />
		<delete dir="deploy" failonerror="false" />
	</target>

	<target depends="clean" name="cleanall"/>

	<target depends="build-subprojects,build-project, build-gwt" name="build"/>

	<target name="build-subprojects"/>

	<target depends="init" name="build-project">
		<echo message="${ant.project.name}: ${ant.file}"/>

		<javac debug="true" debuglevel="${debuglevel}" destdir="war/WEB-INF/classes" source="${source}" target="${target}" encoding="UTF-8">
			<src path="src"/>
			<classpath refid="agitos.classpath"/>
		</javac>

		<javac debug="true" debuglevel="${debuglevel}" destdir="war/WEB-INF/classes" source="${source}" target="${target}" encoding="UTF-8">
			<src path="test"/>
			<classpath refid="agitos.classpath"/>
		</javac>

		<javac debug="true" debuglevel="${debuglevel}" destdir="war/WEB-INF/classes" source="${source}" target="${target}" encoding="UTF-8">
			<src path="spikes"/>
			<exclude name="samples/jetty_prevayler/"/>
			<exclude name="samples/jetty_prevayler2/"/>
			<exclude name="samples/jetty_prevayler3/"/>
			<exclude name="samples/jetty_prevayler3/simpleprevalent/"/>
			<exclude name="samples/jetty_prevayler3/simpleservlet/"/>
			<exclude name="samples/jetty_servlet/"/>
			<exclude name="samples/restlet/"/>
			<exclude name="foundation/"/>
			<exclude name="foundation/lang/exceptions/"/>
			<exclude name="org/prevayler/bubble/"/>
			<exclude name="org/prevayler/bubble/tests/"/>
			<exclude name="org/prevayler/bubble/tests/fixtures/"/>
			<exclude name="org/prevayler/bubble/tests/fixtures/brick2/"/>
			<exclude name="org/prevayler/bubble/tests/fixtures/brick2/impl/"/>
			<exclude name="org/prevayler/bubble/tests/fixtures/impl/"/>
			<exclude name="org/prevayler/bubble/tests/fixturesnew/"/>
			<exclude name="org/prevayler/bubble/tests/fixturesnew/SomeApplication.java"/>
			<exclude name="org/prevayler/bubble/tests/fixturesnew/SomeApplicationImpl.java"/>
			<exclude name="org/prevayler/"/>
			<classpath refid="agitos.classpath"/>
		</javac>

		<javac debug="true" debuglevel="${debuglevel}" destdir="war/WEB-INF/classes" source="${source}" target="${target}" encoding="UTF-8">
			<src path="config"/>
			<classpath refid="agitos.classpath"/>
		</javac>

	</target>

	<target name="build-gwt" depends="build-project" description="GWT compile to JavaScript (production mode)">
		<java failonerror="true" fork="true" classname="com.google.gwt.dev.Compiler">
			<classpath>
				<pathelement location="src"/>
				<path refid="agitos.classpath"/>
			</classpath>
			<!-- add jvmarg -Xss16M or similar if you see a StackOverflowError -->
			<jvmarg value="-Xmx256M"/>
			<arg line="-war"/>
			<arg value="war"/>
			<!-- Additional arguments like -style PRETTY or -logLevel DEBUG -->
			<arg line="${gwt.args}"/>
			<arg value="guardachuva.agitos.AgitosClient"/>
		</java>
	</target>

	<target name="devmode" depends="build-project" description="Run development mode">
		<java failonerror="true" fork="true" classname="com.google.gwt.dev.DevMode">
			<classpath>
				<pathelement location="src"/>
				<path refid="agitos.classpath"/>
			</classpath>
			<jvmarg value="-Xmx256M"/>
			<arg value="-startupUrl"/>
			<arg value="index.html"/>
			<arg line="-war"/>
			<arg value="war"/>
			<!-- Additional arguments like -style PRETTY or -logLevel DEBUG -->
			<arg line="${gwt.args}"/>
			<arg value="guardachuva.agitos.AgitosClient"/>
		</java>
	</target>

	<target name="war" depends="build" description="Create a war file">
		<mkdir dir="deploy"/>
		<zip destfile="deploy/agitos.war" basedir="war" />
	</target>


	<target description="Build all projects which reference this project. Useful to propagate changes." name="build-refprojects"/>
	<target name="agitos">
		<mkdir dir="${junit.output.dir}"/>
		<junit fork="yes" printsummary="withOutAndErr">
			<formatter type="xml"/>
			<test name="guardachuva.agitos.AceitacaoTest" todir="${junit.output.dir}"/>
			<test name="guardachuva.agitos.server.crypt.CryptoTest" todir="${junit.output.dir}"/>
			<test name="guardachuva.agitos.server.domain_tests.EventTest" todir="${junit.output.dir}" />
			<test name="guardachuva.agitos.server.domain_tests.UserConfigTest" todir="${junit.output.dir}" />
			<test name="guardachuva.agitos.server.domain_tests.UserTest" todir="${junit.output.dir}" />
			<test name="guardachuva.agitos.shared_tests.ValidationsTest" todir="${junit.output.dir}" />
			<classpath refid="agitos.classpath" />
		</junit>
	</target>

	<target name="junitreport">
		<junitreport todir="${junit.output.dir}">
			<fileset dir="${junit.output.dir}">
				<include name="TEST-*.xml" />
			</fileset>
			<report format="frames" todir="${junit.output.dir}" />
		</junitreport>
	</target>
</project>
